{"version":3,"sources":["components/Knob.js","components/LabeledKnob.js","components/WaveformSelector.js","components/icon/SineWaveIcon.js","components/icon/TriangleWaveIcon.js","components/icon/SquareWaveIcon.js","components/icon/SawtoothWaveIcon.js","utils/KeyboardUtils.js","components/Keyboard.js","components/DegreeKnob.js","components/Sequencer.js","components/Oscilloscope.js","components/SpectrumAnalyser.js","components/VisibilitySettings.js","Synthesizer.js","utils/AudioUtils.js","webRtcConnection.js","components/SynthContainer.js","App.js","registerServiceWorker.js","index.js"],"names":["Knob","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","min","max","value","state","hideOverflow","inputTranslationFraction","inputOnChange","bind","assertThisInitialized","inputRef","addEventListener","removeEventListener","e","_this$props","rotationFraction","setState","_this2","_this$props2","step","onChange","rotationDegrees","react_default","a","createElement","className","style","overflow","transform","concat","type","Number","target","ref","onMouseDown","onMouseUp","React","Component","defaultProps","LabeledKnob","_ref","label","valueKey","config","src_components_Knob","toFixed","options","viewBox","d","WaveformSelector","react_select_lib_default","_ref2","clearable","searchable","keyToDegree","q","2","w","3","r","5","t","6","y","7","u","i","9","o","0","p","[","=","]","degreeToNote","-9","-8","-7","-6","-5","-4","-3","-2","-1","1","4","8","10","keyToPosition","degreeToFrequency","degree","Math","pow","Keyboard","keysHeld","sequencedNote","onKeyDown","onKeyUp","document","body","doFrame","_this2$props","getCurrentTime","tempo","pattern","secondsPerBeat","currentBeatIndex","floor","currentNote","activeSettings","degreeSettings","animationFrame","requestAnimationFrame","cancelAnimationFrame","includes","key","toConsumableArray","_ref3","pull","_this$state","whiteKeys","entries","filter","_ref4","_ref5","slicedToArray","sort","_ref6","_ref7","blackKeys","_ref10","_ref11","_ref12","_ref13","height","position","padding","map","_ref16","_ref17","left","paddingTop","_ref18","_ref19","DegreeKnob","noteDegrees","values","minNoteDegree","apply","maxNoteDegree","Sequencer","beatIndex","onKnobChanged","onNoteDegreeChange","selected","onNoteActiveChange","_this3","_this$props$pattern","mergedDegreeSettings","objectSpread","range","reduce","acc","defineProperty","wrapperClasses","components_DegreeKnob","id","checked","Boolean","onNoteSelected","htmlFor","Oscilloscope","analyser","bufferLength","fftSize","dataArray","Float32Array","canvasCtx","canvasRef","getContext","onAnimationFrame","firstCross","vco1Octave","vco2Octave","freq","sampleRate","oscPeriod","timeInSamples","round","getFloatTimeDomainData","length","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","sliceWidth","WIDTH","x","HEIGHT","moveTo","lineTo","width","stroke","SpectrumAnalyser","getFloatFrequencyData","logScale","log","SectionSetting","sectionName","VisibilitySettings","sectionsShown","defaultConfig","vco1Volume","vco1Waveform","vco1Detune","vco2Volume","vco2Waveform","vco2Detune","noiseVolume","fltHighPassFreq","fltHighPassRes","fltLowPassFreq","fltLowPassRes","globalVolume","lfoFreq","vcoFreqEnvMod","vcoFreqLfoMod","fltHpEnvMod","fltHpLfoMod","fltLpEnvMod","fltLpLfoMod","envAttack","envDecay","envSustain","envRelease","createSynthesizer","audioCtx","vco1","createOscillator","frequency","detune","start","vco1OctaveDetune","createConstantSource","offset","vco2","vco2OctaveDetune","noiseSource","noiseBuf","createBuffer","channel","numberOfChannels","nowBuffering","getChannelData","random","createBufferSource","buffer","loop","createNoiseSource","vco1Amp","createGain","gain","vco2Amp","noiseAmp","vcoOverallAmp","fltHighPass","createBiquadFilter","Q","fltLowPass","volume","envelopeSource","envelopeGain","setValueAtTime","connect","envelopeGenerator","EnvGen","mode","attackTime","decayTime","sustainLevel","releaseTime","lfo","createAnalyser","destination","configToUpdater","v","arguments","undefined","scheduleAttackAtTime","time","gateOn","scheduleReleaseAtTime","gateOff","setVcoFrequencyAtTime","updateConfig","configUpdates","forEach","updater","peers","onOpen","domSystemTime","getElementById","domSyncTime","domOffset","domSyncing","ts","timesync","interval","delay","timeout","now","currentTime","on","console","peer","connections","keys","some","conn","open","openConnections","join","innerHTML","send","data","all","Error","toString","setTimeout","updateDisplay","innerText","Peer","host","port","secure","debug","connectToPeers","setupConnection","receive","err","setInterval","convertToBooleanConfig","convertToNumericConfig","isNaN","defaultSectionsShown","keyboard","sequencer","modulation","getStateFromQueryString","queryString","window","location","search","slice","queryParams","qs","arrayLimit","synthConfig","omit","na","nd","ss","SynthContainer","queryState","AudioContext","latencyHint","synthesizer","keyIsHeld","vco1Freq","vco2Freq","isLeader","peerId","connectedPeerId","onConfigChange","onVisibilityChange","connectToPeer","becomeLeader","pushHistoryUpdateDebounced","debounce","pushHistoryUpdate","trailing","push","onKeysChanged","splice","indexOf","lastScheduledTime","scheduleNotes","startTime","endTime","NOTE_SCHEDULING_RANGE_MS","nextAttackIndex","ceil","attacks","_this2$state$pattern","attackIndex","scheduleAttack","nextAttackTime","timeToRelease","pingPeer","socket","_connect","_this4","_this$state$pattern","configDiff","_ref8","_ref9","_ref14","_ref15","diff","history","pushState","onReleaseTrigger","onAttackTrigger","setVcoFreq","note","_this5","active","_this6","_this7","_this8","_this9","_this$state2","VisibilitySettings_VisibilitySettings","src_components_Keyboard","src_components_Sequencer","components_WaveformSelector","components_LabeledKnob","components_Oscilloscope","components_SpectrumAnalyser","onClick","marginTop","App","components_SynthContainer","isLocalhost","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","catch","error","ReactDOM","render","src_App_0","URL","process","origin","fetch","response","status","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.a87fe756.chunk.js","sourcesContent":["import React from 'react';\nimport './Knob.css';\n\nconst KNOB_RANGE_DEGREES = 270;\nconst KNOB_START_DEGREES = -1 * (360 - KNOB_RANGE_DEGREES) / 2;\n\nconst SLIDER_WIDTH_PX = 250;\n\nconst defaultProps = {\n  min: 0,\n  max: 1,\n  step: 'any',\n};\n\nclass Knob extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const {\n      min,\n      max,\n      value,\n    } = props;\n\n    this.state = {\n      hideOverflow: true,\n      inputTranslationFraction: (value - min) / (max - min),\n    };\n\n    this.inputOnChange = this.inputOnChange.bind(this);\n  }\n\n  componentDidMount() {\n    this.inputRef.addEventListener('change', this.inputOnChange);\n  }\n\n  componentWillUnmount() {\n    this.inputRef.removeEventListener('change', this.inputOnChange);\n  }\n\n  inputOnChange(e) {\n    const {\n      min,\n      max,\n      value,\n    } = this.props;\n\n    const rotationFraction = (value - min) / (max - min);\n\n    this.setState({\n      hideOverflow: true,\n      inputTranslationFraction: rotationFraction\n    });\n  }\n\n  render() {\n    const {\n      min,\n      max,\n      value,\n      step,\n      onChange,\n    } = this.props;\n\n    const {\n      hideOverflow,\n    } = this.state;\n\n    const { inputTranslationFraction } = this.state;\n\n    const rotationFraction = (value - min) / (max - min);\n    const rotationDegrees = KNOB_START_DEGREES + KNOB_RANGE_DEGREES * rotationFraction;\n\n    return (\n      <div\n        className=\"knob__container\"\n        style={{\n          overflow: hideOverflow ? 'hidden' : 'visible',\n        }}\n      >\n        <div\n          className=\"knob__spinner\"\n          style={{\n            transform: `rotate(${rotationDegrees}deg)`\n          }}\n        >\n          <div className=\"knob__marker\"></div>\n        </div>\n        <input\n          type=\"range\"\n          className=\"knob__input\"\n          min={min}\n          max={max}\n          step={step}\n          value={value}\n          onChange={(e) => { onChange(Number(e.target.value)); }}\n          ref={(ref) => { this.inputRef = ref; }}\n          onMouseDown={() => {\n            this.setState({\n              hideOverflow: false,\n            });\n          }}\n          onMouseUp={this.inputOnChange}\n          style={{\n            transform: `translate(${-inputTranslationFraction * SLIDER_WIDTH_PX}px, 0)`,\n          }}\n        />\n      </div>\n    );\n  }\n}\n\nKnob.defaultProps = defaultProps;\n\nexport default Knob;\n","import React from 'react';\nimport './LabeledKnob.css';\n\nimport Knob from './Knob';\n\nconst defaultProps = {\n  min: 0,\n  max: 1,\n  step: 'any',\n};\n\nfunction LabeledKnob({\n  label,\n  min,\n  max,\n  step,\n  valueKey,\n  config,\n  onChange,\n}) {\n  return (\n    <div>\n      <div className=\"labeled-knob__label\">\n        {label}\n      </div>\n      <Knob\n        min={min}\n        max={max}\n        step={step}\n        value={config[valueKey]}\n        onChange={(value) => onChange(valueKey, value)}\n      />\n      <div className=\"labeled-knob__value\">\n        {Number(config[valueKey]).toFixed(1)}\n      </div>\n    </div>\n  );\n}\n\nLabeledKnob.defaultProps = defaultProps;\n\nexport default LabeledKnob;\n","import React from 'react';\nimport Select from 'react-select';\nimport 'react-select/dist/react-select.css';\n\nimport './WaveformSelector.css';\nimport SineWaveIcon from './icon/SineWaveIcon';\nimport TriangleWaveIcon from './icon/TriangleWaveIcon';\nimport SquareWaveIcon from './icon/SquareWaveIcon';\nimport SawtoothWaveIcon from './icon/SawtoothWaveIcon';\n\nconst options = [\n  { value: 'sine', label: <span><SineWaveIcon />Sine</span> },\n  { value: 'triangle', label: <span><TriangleWaveIcon />Triangle</span> },\n  { value: 'square', label: <span><SquareWaveIcon />Square</span> },\n  { value: 'sawtooth', label: <span><SawtoothWaveIcon />Sawtooth</span> },\n];\n\n\nfunction WaveformSelector({\n  value,\n  onChange,\n}) {\n  return (\n    <Select\n      className=\"waveform-selector\"\n      options={options}\n      value={value}\n      onChange={({ value }) => onChange(value)}\n      clearable={false}\n      searchable={false}\n    />\n  );\n}\n\nexport default WaveformSelector;\n","import React from 'react';\n\nexport default function SineWaveIcon() {\n  return (\n    <svg viewBox=\"0 25 100 50\" className=\"waveform-icon\">\n      <path d=\"M89.2 60.8c-4.5 0-6.6-5.3-8.6-10.4-1.8-4.5-3.6-9.1-6.8-9.1s-5 4.6-6.8 9.1c-2 5.1-4.1 10.4-8.6 10.4s-6.6-5.3-8.6-10.4c-1.8-4.5-3.6-9.1-6.8-9.1s-5 4.6-6.8 9.1c-2 5.1-4.1 10.4-8.6 10.4S21 55.5 19 50.4c-1.8-4.5-3.6-9.1-6.8-9.1-.6 0-1-.4-1-1s.4-1 1-1c4.5 0 6.6 5.3 8.6 10.4 1.8 4.5 3.6 9.1 6.8 9.1 3.2 0 5-4.6 6.8-9.1 2-5.1 4.1-10.4 8.6-10.4s6.6 5.3 8.6 10.4c1.8 4.5 3.6 9.1 6.8 9.1 3.2 0 5-4.6 6.8-9.1 2-5.1 4.1-10.4 8.6-10.4s6.6 5.3 8.6 10.4c1.8 4.5 3.6 9.1 6.8 9.1.6 0 1 .4 1 1s-.4 1-1 1z\" />\n    </svg>\n  );\n}\n","import React from 'react';\n\nexport default function TriangleWaveIcon() {\n  return (\n    <svg viewBox=\"0 25 100 50\" className=\"waveform-icon\">\n      <path d=\"M57.5 61.7l-15-20-15 20-15.8-21.1 1.6-1.2 14.2 18.9 15-20 15 20 15-20 15.8 21.1-1.6 1.2-14.2-18.9z\"/>\n    </svg>\n  );\n}\n","import React from 'react';\n\nexport default function SquareWaveIcon() {\n  return (\n    <svg viewBox=\"0 25 100 50\" className=\"waveform-icon\">\n      <path d=\"M95 61H79V41H66v20H49V41H36v20H19V41H5v-2h16v20h13V39h17v20h13V39h17v20h14z\"/>\n    </svg>\n  );\n}\n","import React from 'react';\n\nexport default function SawtoothWaveIcon() {\n  return (\n    <svg viewBox=\"0 25 100 50\" className=\"waveform-icon\">\n      <g transform=\"scale(-1,1) translate(-100, 0)\">\n        <path d=\"M64 61.9v-20l-30 20v-20L5.6 60.8l-1.2-1.6L36 38.1v20l30-20v20l28.4-18.9 1.2 1.6z\" />\n      </g>\n    </svg>\n  );\n}\n","export const keyToDegree = {\n  'q': -9,\n  '2': -8,\n  'w': -7,\n  '3': -6,\n  'e': -5,\n  'r': -4,\n  '5': -3,\n  't': -2,\n  '6': -1,\n  'y': 0,  // A 440\n  '7': 1,\n  'u': 2,\n  'i': 3,\n  '9': 4,\n  'o': 5,\n  '0': 6,\n  'p': 7,\n  '[': 8,\n  '=': 9,\n  ']': 10,\n};\n\nexport const degreeToNote = {\n  '-9': 'C -1',\n  '-8': 'C# -1',\n  '-7': 'D -1',\n  '-6': 'D# -1',\n  '-5': 'E -1',\n  '-4': 'F -1',\n  '-3': 'F# -1',\n  '-2': 'G -1',\n  '-1': 'G#',\n  '0': 'A',\n  '1': 'A#',\n  '2': 'B',\n  '3': 'C',\n  '4': 'C#',\n  '5': 'D',\n  '6': 'D#',\n  '7': 'E',\n  '8': 'F',\n  '9': 'F#',\n  '10': 'G',\n};\n\nexport const keyToPosition = {\n  'q': 0,\n  '2': 0.5,\n  'w': 1,\n  '3': 1.5,\n  'e': 2,\n  'r': 3,\n  '5': 3.5,\n  't': 4,\n  '6': 4.5,\n  'y': 5,  // A 440\n  '7': 5.5,\n  'u': 6,\n  'i': 7,\n  '9': 7.5,\n  'o': 8,\n  '0': 8.5,\n  'p': 9,\n  '[': 10,\n  '=': 10.5,\n  ']': 11,\n};\n\nexport function getDegreeForKey(key) {\n  return keyToDegree[key];\n}\n\nexport function degreeToFrequency(degree) {\n  return 440 * (1.059463094359 ** degree);\n}\n","import React from 'react';\nimport { pull } from 'lodash';\nimport './Keyboard.css';\nimport {\n  keyToPosition,\n  keyToDegree,\n} from '../utils/KeyboardUtils';\n\nclass Keyboard extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      keysHeld: [],\n      sequencedNote: null,\n    };\n\n    this.onKeyDown = this.onKeyDown.bind(this);\n    this.onKeyUp = this.onKeyUp.bind(this);\n  }\n\n  componentDidMount() {\n    document.body.addEventListener('keydown', this.onKeyDown);\n    document.body.addEventListener('keyup', this.onKeyUp);\n\n    const doFrame = () => {\n      this.setState(({ sequencedNote }) => {\n        const { getCurrentTime, tempo, pattern } = this.props;\n        const secondsPerBeat = (60 / (tempo * 4));\n        const currentBeatIndex = Math.floor(getCurrentTime() / secondsPerBeat) % 16;\n\n        const currentNote = pattern.activeSettings[currentBeatIndex]\n          ? (pattern.degreeSettings[currentBeatIndex] || 0)\n          : null;\n\n        if (sequencedNote === currentNote) {\n          return null;\n        }\n\n        return { sequencedNote: currentNote };\n      });\n      this.animationFrame = requestAnimationFrame(doFrame);\n    };\n\n    doFrame();\n  }\n\n  componentWillUnmount() {\n    document.body.removeEventListener('keydown', this.onKeyDown);\n    document.body.removeEventListener('keyup', this.onKeyUp);\n\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n    }\n  }\n\n  onKeyDown(e) {\n    this.setState(({ keysHeld }) => {\n      if (!keysHeld.includes(e.key) && e.key in keyToPosition) {\n        return {\n          keysHeld: [\n            ...keysHeld,\n            e.key,\n          ],\n        };\n      }\n    });\n  }\n\n  onKeyUp(e) {\n    this.setState(({ keysHeld }) => {\n      return {\n        keysHeld: pull(keysHeld, e.key),\n      };\n    });\n  }\n\n  render() {\n    const { keysHeld, sequencedNote } = this.state;\n    const whiteKeys = Object.entries(keyToPosition)\n      .filter(([key, position]) => position % 1 === 0)\n      .sort(([, positionA], [, positionB]) => positionA - positionB);\n    const blackKeys = Object.entries(keyToPosition)\n      .filter(([key, position]) => position % 1 !== 0)\n      .sort(([, positionA], [, positionB]) => positionA - positionB);\n\n    return (\n      <div style={{ height: 70, position: 'relative', padding: 10 }}>\n        <div>\n          {blackKeys.map(([key, position]) => {\n            let className = 'key key--black';\n            if (keysHeld.includes(key)) {\n              className += ' key--pressed';\n            } else if (sequencedNote === keyToDegree[key]) {\n              className += ' key--sequenced';\n            }\n\n            return (\n              <div\n                key={key}\n                className={className}\n                style={{\n                  position: 'absolute',\n                  left: position * 45,\n                }}\n              >\n                {key}\n              </div>\n            );\n          })}\n        </div>\n        <div style={{ paddingTop: 35 }}>\n          {whiteKeys.map(([key, position]) => {\n            let className = 'key key--white';\n            if (keysHeld.includes(key)) {\n              className += ' key--pressed';\n            } else if (sequencedNote === keyToDegree[key]) {\n              className += ' key--sequenced';\n            }\n            return (\n              <div\n                key={key}\n                className={className}\n                style={{\n                  position: 'absolute',\n                  left: position * 45,\n                }}\n              >\n                {key}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Keyboard;\n","import React from 'react';\nimport './DegreeKnob.css';\n\nimport { degreeToNote } from '../utils/KeyboardUtils';\n\n\nimport Knob from './Knob';\n\nconst defaultProps = {\n  min: 0,\n  max: 1,\n  step: 'any',\n};\n\nfunction DegreeKnob({\n  label,\n  min,\n  max,\n  step,\n  valueKey,\n  config,\n  onChange,\n}) {\n  return (\n    <div>\n      <Knob\n        min={min}\n        max={max}\n        step={step}\n        value={config[valueKey]}\n        onChange={(value) => onChange(valueKey, value)}\n      />\n      <div className=\"degree-knob__value\">\n        {degreeToNote[config[valueKey]]}\n      </div>\n    </div>\n  );\n}\n\nDegreeKnob.defaultProps = defaultProps;\n\nexport default DegreeKnob;\n","import React from 'react';\nimport { range } from 'lodash'\n\nimport { keyToDegree } from '../utils/KeyboardUtils';\n\nimport './Sequencer.css';\n\nimport DegreeKnob from './DegreeKnob';\n\nconst noteDegrees = Object.values(keyToDegree);\nconst minNoteDegree = Math.min(...noteDegrees);\nconst maxNoteDegree = Math.max(...noteDegrees);\n\nclass Sequencer extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      beatIndex: 0,\n    };\n\n    this.onKnobChanged = this.onKnobChanged.bind(this);\n  }\n\n  componentDidMount() {\n    const { getCurrentTime, tempo } = this.props;\n    const doFrame = () => {\n      this.setState(({ beatIndex }) => {\n        const secondsPerBeat = (60 / (tempo * 4));\n        const currentBeatIndex = Math.floor(getCurrentTime() / secondsPerBeat) % 16;\n        if (currentBeatIndex === beatIndex) {\n          return null;\n        }\n\n        return { beatIndex: currentBeatIndex };\n      });\n      this.animationFrame = requestAnimationFrame(doFrame);\n    };\n\n    doFrame();\n  }\n\n  componentWillUnmount() {\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n    }\n  }\n\n  onKnobChanged(key, value) {\n    const { onNoteDegreeChange } = this.props;\n    onNoteDegreeChange(key, value);\n  }\n\n  onNoteSelected(degree, selected) {\n    const { onNoteActiveChange } = this.props;\n    onNoteActiveChange(degree, selected);\n  }\n\n  render() {\n    const {\n      pattern: {\n        degreeSettings,\n        activeSettings,\n      },\n    } = this.props;\n\n    const { beatIndex } = this.state;\n\n    const mergedDegreeSettings = {\n      ...range(16).reduce((acc, i) => ({\n        ...acc,\n        [i]: 0,\n      }), {}),\n      ...degreeSettings,\n    };\n\n    return (\n      <div className=\"sequencer__container\">\n        {range(16).map(i => {\n          const wrapperClasses = 'sequencer-note' + (beatIndex === i ? ' sequencer-note--current' : '');\n          return (\n            <div key={i} className={wrapperClasses}>\n              <DegreeKnob\n                valueKey={i}\n                min={minNoteDegree}\n                max={maxNoteDegree}\n                step={1}\n                onChange={this.onKnobChanged}\n                config={mergedDegreeSettings}\n              />\n              <div>\n                <input\n                  id={`note-active-${i}`}\n                  className=\"sequencer-note__checkbox\"\n                  type=\"checkbox\"\n                  checked={Boolean(activeSettings[i])}\n                  onChange={(e) => this.onNoteSelected(i, e.target.checked)}\n                />\n                <label\n                  htmlFor={`note-active-${i}`}\n                />\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nexport default Sequencer;\n","import React from 'react';\n\nclass Oscilloscope extends React.Component {\n\n  componentDidMount() {\n    const { analyser } = this.props;\n    const bufferLength = analyser.fftSize;\n    const dataArray = new Float32Array(bufferLength);\n\n    const WIDTH = 300;\n    const HEIGHT = 150;\n\n    const canvasCtx = this.canvasRef.getContext('2d');\n\n    const onAnimationFrame = () => {\n      const { vco1Octave, vco2Octave, freq, sampleRate } = this.props;\n      // Code here adapted from:\n      // https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API\n      const oscPeriod = 1 / (Math.min(freq * (2 ** vco1Octave), freq * (2 ** vco2Octave)) || 440);\n      const timeInSamples = Math.round(4 * oscPeriod * sampleRate);\n      analyser.getFloatTimeDomainData(dataArray);\n\n      let firstCross;\n      for (let i = 0; i < dataArray.length -1; i += 1) {\n        if (dataArray[i] > 0 && dataArray[i + 1] <= 0) {\n          firstCross = i;\n          break;\n        }\n      }\n\n      canvasCtx.fillStyle = 'rgb(200, 200, 200)';\n      canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);\n\n      canvasCtx.lineWidth = 2;\n      canvasCtx.strokeStyle = 'rgb(0, 0, 0)';\n\n      canvasCtx.beginPath();\n\n      let sliceWidth = WIDTH * 1.0 / (Math.min(timeInSamples / 2, bufferLength));\n      let x = 0;\n\n      for(let i = firstCross; i < Math.min(timeInSamples, bufferLength); i++) {\n\n        let v = dataArray[i];\n        let y = v * 0.5 * HEIGHT/2 + HEIGHT / 2;\n\n        if(i === 0) {\n          canvasCtx.moveTo(x, y);\n        } else {\n          canvasCtx.lineTo(x, y);\n        }\n\n        x += sliceWidth;\n      }\n\n      canvasCtx.lineTo(this.canvasRef.width, this.canvasRef.height/2);\n      canvasCtx.stroke();\n\n      requestAnimationFrame(onAnimationFrame);\n    };\n\n    requestAnimationFrame(onAnimationFrame);\n  }\n\n  render() {\n    return (\n      <canvas ref={(ref) => { this.canvasRef = ref; }} style={{ width: 300, height: 150 }} />\n    );\n  }\n}\n\nexport default Oscilloscope;\n","import React from 'react';\n\nclass SpectrumAnalyser extends React.Component {\n  componentDidMount() {\n    const { analyser } = this.props;\n    const bufferLength = analyser.fftSize;\n    const dataArray = new Float32Array(bufferLength);\n\n    const WIDTH = 300;\n    const HEIGHT = 150;\n\n    const canvasCtx = this.canvasRef.getContext('2d');\n\n    const onAnimationFrame = () => {\n      // Code here adapted from:\n      // https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API\n      analyser.getFloatFrequencyData(dataArray);\n\n      canvasCtx.fillStyle = 'rgb(200, 200, 200)';\n      canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);\n\n      canvasCtx.lineWidth = 2;\n      canvasCtx.strokeStyle = 'rgb(0, 0, 0)';\n\n      canvasCtx.beginPath();\n\n      const logScale = WIDTH * 1.0 / Math.log(bufferLength / 2);\n\n      for(let i = 0; i < bufferLength / 2; i++) {\n\n        const v = dataArray[i];\n        const y = (0.4 - (v / 100)) * HEIGHT / 2;\n\n        const x =  Math.log(i + 1) * logScale;\n\n        if(i === 0) {\n          canvasCtx.moveTo(x, y);\n        } else {\n          canvasCtx.lineTo(x, y);\n        }\n\n      }\n\n      canvasCtx.lineTo(this.canvasRef.width, this.canvasRef.height/2);\n      canvasCtx.stroke();\n\n      requestAnimationFrame(onAnimationFrame);\n    };\n\n    onAnimationFrame();\n  }\n\n  render() {\n    return (\n      <canvas ref={(ref) => { this.canvasRef = ref; }} style={{ width: 300, height: 150 }} />\n    );\n  }\n}\n\nexport default SpectrumAnalyser;\n","import React from 'react';\nimport './VisibilitySettings.css'\n\nfunction SectionSetting({\n  sectionName,\n  selected,\n  onChange,\n}) {\n  return (\n    <label className=\"section-setting\">\n      {sectionName}\n      <input\n        id={`${sectionName}-is-visible-checkbox`}\n        type=\"checkbox\"\n        checked={selected}\n        onChange={(e) => onChange(sectionName, e.target.checked)}\n      />\n    </label>\n  );\n}\n\nexport default function VisibilitySettings({\n  sectionsShown,\n  onChange,\n}) {\n  return (\n    <div className=\"visibility-settings\">\n      {Object.entries(sectionsShown).map(([sectionName, selected]) => (\n        <SectionSetting\n          key={sectionName}\n          sectionName={sectionName}\n          selected={selected}\n          onChange={(sectionName, checked) => onChange({\n            ...sectionsShown,\n            [sectionName]: checked,\n          })}\n        />\n      ))}\n    </div>\n  );\n}\n","import * as EnvGen from 'fastidious-envelope-generator';\n\nimport {\n  createNoiseSource,\n} from './utils/AudioUtils';\n\n\nexport const defaultConfig = {\n  // Sources\n  vco1Volume: 1,\n  vco1Waveform: 'sine',\n  vco1Detune: 0,\n  vco1Octave: 0,\n\n  vco2Volume: 1,\n  vco2Waveform: 'sine',\n  vco2Detune: 0,\n  vco2Octave: 0,\n\n  noiseVolume: 0,\n\n  // Filters\n  fltHighPassFreq: 0,\n  fltHighPassRes: 0,\n\n  fltLowPassFreq: 10000,\n  fltLowPassRes: 0,\n\n  // Global\n  globalVolume: 0.3,\n\n  // Modulation\n  lfoFreq: 2,\n\n  vcoFreqEnvMod: 0,\n  vcoFreqLfoMod: 0,\n\n  fltHpEnvMod: 0,\n  fltHpLfoMod: 0,\n  fltLpEnvMod: 0,\n  fltLpLfoMod: 0,\n\n  envAttack: 0.0004,\n  envDecay: 0.0004,\n  envSustain: 0.5,\n  envRelease: 0.0004,\n};\n\n\nexport default function createSynthesizer(config, audioCtx) {\n  // Sound sources ------------------------\n  const vco1 = audioCtx.createOscillator();\n  vco1.type = config.vco1Waveform;\n  vco1.frequency.value = 440;\n  vco1.detune.value = config.vco1Detune\n  vco1.start();\n  const vco1OctaveDetune = audioCtx.createConstantSource();\n  vco1OctaveDetune.offset.value = config.vco1Octave * 1200;\n  vco1OctaveDetune.start();\n\n  const vco2 = audioCtx.createOscillator();\n  vco2.type = config.vco2Waveform;\n  vco2.frequency.value = 440; // value in hertz\n  vco1.detune.value = config.vco2Detune\n  vco2.start();\n  const vco2OctaveDetune = audioCtx.createConstantSource();\n  vco2OctaveDetune.offset.value = config.vco2Octave * 1200;\n  vco2OctaveDetune.start();\n\n  const noiseSource = createNoiseSource(audioCtx);\n\n\n  // Source amps --------------------------\n  const vco1Amp = audioCtx.createGain();\n  vco1Amp.gain.value = config.vco1Volume;\n\n  const vco2Amp = audioCtx.createGain();\n  vco2Amp.gain.value = config.vco2Volume;\n\n  const noiseAmp = audioCtx.createGain();\n  noiseAmp.gain.value = config.noiseVolume;\n\n  const vcoOverallAmp = audioCtx.createGain();\n  vcoOverallAmp.gain.value = 0;\n\n\n  // Filters ------------------------------\n  const fltHighPass = audioCtx.createBiquadFilter();\n  fltHighPass.type = 'highpass';\n  fltHighPass.Q.value = config.fltHighPassRes;\n  fltHighPass.frequency.value = config.fltHighPassFreq;\n\n  const fltLowPass = audioCtx.createBiquadFilter();\n  fltLowPass.type = 'lowpass';\n  fltLowPass.Q.value = config.fltLowPassRes;\n  fltLowPass.frequency.value = config.fltLowPassFreq;\n\n\n  // Global effects -----------------------\n  const volume = audioCtx.createGain();\n  volume.gain.value = config.globalVolume;\n\n\n  // Modulation generators ----------------\n  const envelopeSource = audioCtx.createConstantSource();\n  envelopeSource.offset.value = 1;\n  envelopeSource.start();\n\n  const envelopeGain = audioCtx.createGain();\n  envelopeGain.gain.setValueAtTime(0, 0);\n  envelopeSource.connect(envelopeGain);\n\n  const envelopeGenerator = new EnvGen(audioCtx, envelopeGain.gain);\n  envelopeGenerator.mode = 'ADSR';\n  envelopeGenerator.attackTime = config.envAttack;\n  envelopeGenerator.decayTime = config.envDecay;\n  envelopeGenerator.sustainLevel = config.envSustain;\n  envelopeGenerator.releaseTime = config.envRelease;\n\n  const lfo = audioCtx.createOscillator();\n  lfo.type = 'triangle';\n  lfo.frequency.value = config.lfoFreq;\n  lfo.start();\n\n\n  // Modulation gains ---------------------\n  const vcoFreqEnvMod = audioCtx.createGain();\n  vcoFreqEnvMod.gain.value = config.vcoFreqEnvMod;\n\n  const vcoFreqLfoMod = audioCtx.createGain();\n  vcoFreqLfoMod.gain.value = config.vcoFreqLfoMod;\n\n  const fltHpEnvMod = audioCtx.createGain();\n  fltHpEnvMod.gain.value = config.fltHpEnvMod;\n\n  const fltHpLfoMod = audioCtx.createGain();\n  fltHpLfoMod.gain.value = config.fltHpLfoMod;\n\n  const fltLpEnvMod = audioCtx.createGain();\n  fltLpEnvMod.gain.value = config.fltLpEnvMod;\n\n  const fltLpLfoMod = audioCtx.createGain();\n  fltLpLfoMod.gain.value = config.fltLpLfoMod;\n\n  const analyser = audioCtx.createAnalyser();\n  analyser.fftSize = 4096;\n\n\n  // Basic wiring\n  vco1.connect(vco1Amp);\n  vco2.connect(vco2Amp);\n  noiseSource.connect(noiseAmp);\n\n  vco1Amp.connect(vcoOverallAmp);\n  vco2Amp.connect(vcoOverallAmp);\n  noiseAmp.connect(vcoOverallAmp);\n\n  vcoOverallAmp.connect(fltHighPass);\n\n  fltHighPass.connect(fltLowPass);\n\n  fltLowPass.connect(volume);\n  fltLowPass.connect(analyser);\n  volume.connect(audioCtx.destination);\n\n\n  // Modulation connections\n  envelopeGain.connect(vcoOverallAmp.gain);\n  envelopeGain.connect(vcoFreqEnvMod);\n  envelopeGain.connect(fltHpEnvMod);\n  envelopeGain.connect(fltLpEnvMod);\n\n  fltHpEnvMod.connect(fltHighPass.detune);\n  fltHpLfoMod.connect(fltHighPass.detune);\n\n  fltLpEnvMod.connect(fltLowPass.detune);\n  fltLpLfoMod.connect(fltLowPass.detune);\n\n  lfo.connect(vcoFreqLfoMod);\n  lfo.connect(fltHpLfoMod);\n  lfo.connect(fltLpLfoMod);\n\n  vcoFreqEnvMod.connect(vco1.detune);\n  vcoFreqEnvMod.connect(vco2.detune);\n  vcoFreqLfoMod.connect(vco1.detune);\n  vcoFreqLfoMod.connect(vco2.detune);\n  vco1OctaveDetune.connect(vco1.detune);\n  vco2OctaveDetune.connect(vco2.detune);\n\n  const configToUpdater = {\n    vco1Volume(v = 1) { vco1Amp.gain.value = v; },\n    vco1Waveform(v = 'sine') { vco1.type = v; },\n    vco1Detune(v = 0)  { vco1.detune.value = v; },\n    vco1Octave(v = 0) { vco1OctaveDetune.offset.value = v * 1200 },\n\n    vco2Volume(v = 1) { vco2Amp.gain.value = v; },\n    vco2Waveform(v = 'sine') { vco2.type = v; },\n    vco2Detune(v = 0)  { vco2.detune.value = v; },\n    vco2Octave(v = 0) { vco2OctaveDetune.offset.value = v * 1200 },\n\n    noiseVolume(v = 0) { noiseAmp.gain.value = v; },\n\n    // Filters\n    fltHighPassFreq(v = 0) { fltHighPass.frequency.value = v; },\n    fltHighPassRes(v = 0) { fltHighPass.Q.value = v; },\n\n    fltLowPassFreq(v = 0) { fltLowPass.frequency.value = v; },\n    fltLowPassRes(v = 0) { fltLowPass.Q.value = v; },\n\n    // Global\n    globalVolume(v = 0.3) { volume.gain.value = v; },\n\n    // Modulation\n    lfoFreq(v = 2) { lfo.frequency.value = v; },\n\n    vcoFreqEnvMod(v = 0) { vcoFreqEnvMod.gain.value = v; },\n    vcoFreqLfoMod(v = 0) { vcoFreqLfoMod.gain.value = v; },\n\n    fltHpEnvMod(v = 0) { fltHpEnvMod.gain.value = v; },\n    fltHpLfoMod(v = 0) { fltHpLfoMod.gain.value = v; },\n    fltLpEnvMod(v = 0) { fltLpEnvMod.gain.value = v; },\n    fltLpLfoMod(v = 0) { fltLpLfoMod.gain.value = v; },\n    envAttack(v) { envelopeGenerator.attackTime = config.envAttack; },\n    envDecay(v) { envelopeGenerator.decayTime = config.envDecay; },\n    envSustain(v) { envelopeGenerator.sustainLevel = config.envSustain; },\n    envRelease(v) { envelopeGenerator.releaseTime = config.envRelease; },\n  };\n\n  function scheduleAttackAtTime(time) {\n    envelopeGenerator.gateOn(time);\n  }\n\n  function scheduleReleaseAtTime(time) {\n    envelopeGenerator.gateOff(time);\n  }\n\n  function setVcoFrequencyAtTime(frequency, time) {\n    vco1.frequency.setValueAtTime(frequency, time);\n    vco2.frequency.setValueAtTime(frequency, time);\n  }\n\n  function updateConfig(configUpdates) {\n    config = {\n      ...config,\n      ...configUpdates,\n    };\n\n    Object.entries(configUpdates).forEach(([key, value]) => {\n      const updater = configToUpdater[key];\n      if (updater) {\n        updater(value);\n      }\n    });\n  }\n\n  return {\n    scheduleAttackAtTime,\n    scheduleReleaseAtTime,\n    setVcoFrequencyAtTime,\n    updateConfig,\n    analyser,\n  };\n}\n","export function createNoiseSource(audioCtx) {\n  // Source: https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode\n\n  const noiseBuf = audioCtx.createBuffer(2, audioCtx.sampleRate * 3, audioCtx.sampleRate);\n\n  // Fill the buffer with white noise;\n  //just random values between -1.0 and 1.0\n  for (var channel = 0; channel < noiseBuf.numberOfChannels; channel++) {\n    // This gives us the actual ArrayBuffer that contains the data\n    var nowBuffering = noiseBuf.getChannelData(channel);\n    for (var i = 0; i < noiseBuf.length; i++) {\n      // Math.random() is in [0; 1.0]\n      // audio needs to be in [-1.0; 1.0]\n      nowBuffering[i] = Math.random() * 2 - 1;\n    }\n  }\n\n  // Get an AudioBufferSourceNode.\n  // This is the AudioNode to use when we want to play an AudioBuffer\n  const noiseSource = audioCtx.createBufferSource();\n  // set the buffer in the AudioBufferSourceNode\n  noiseSource.buffer = noiseBuf;\n  // start the source playing\n  noiseSource.loop = true;\n  noiseSource.start();\n\n  return noiseSource;\n}\n","import * as timesync from 'timesync';\nimport Peer from 'peerjs';\n\n// This was mostly taken from the Peer.js example from timesync, see\n// https://github.com/enmasseio/timesync\nexport default function connect(peers, audioCtx, onOpen) {\n  const domSystemTime = document.getElementById('systemTime');\n  const domSyncTime   = document.getElementById('syncTime');\n  const domOffset     = document.getElementById('offset');\n  const domSyncing    = document.getElementById('syncing');\n\n  const ts = timesync.create({\n    peers: [], // start empty, will be updated at the start of every synchronization\n    interval: peers.length > 0 ? 5000 : null,\n    delay: 200,\n    timeout: 1000,\n    now: () => audioCtx.currentTime,\n  });\n\n  ts.on('sync', function (state) {\n    console.log('sync ' + state);\n    if (state === 'start') {\n      ts.options.peers = openConnections();\n      console.log('syncing with peers [' + ts.options.peers.join(', ') + ']');\n      if (ts.options.peers.length) {\n        domSyncing.innerHTML = 'syncing with ' + ts.options.peers.join(', ') + '...';\n      }\n    }\n    if (state === 'end') {\n      domSyncing.innerHTML = '';\n    }\n  });\n\n  ts.on('change', function (offset) {\n    console.log('changed offset: ' + offset);\n    domOffset.innerHTML = `Offset: ${offset.toFixed(1)}s`;\n  });\n\n  ts.send = function (id, data) {\n    //console.log('send', id, data);\n    const all = peer.connections[id];\n    const conn = all && all.filter(function (conn) {\n      return conn.open;\n    })[0];\n\n    if (conn) {\n      conn.send(data);\n    }\n    else {\n      console.log(new Error('Cannot send message: not connected to ' + id).toString());\n    }\n  };\n\n  // show the system time and synced time once a second on screen\n  function updateDisplay() {\n    domSystemTime.innerText = `Local time: ${audioCtx.currentTime.toFixed(2)}`;\n    domSyncTime.innerText   = `Synced time: ${ts.now().toFixed(2)}`;\n\n    setTimeout(updateDisplay, 100);\n  }\n  setTimeout(updateDisplay, 100);\n\n  // Create a new Peer with the demo API key\n  const peer = new Peer({\n    host: 'synth-beat-connection.herokuapp.com',\n    port: '443',\n    secure: true,\n    debug: 1,\n  });\n  peer.on('open', connectToPeers);\n  peer.on('connection', setupConnection);\n\n  function openConnections() {\n    if (!peer.connections) {\n      return [];\n    }\n    return Object.keys(peer.connections).filter(function (id) {\n      return peer.connections[id].some(function (conn) {\n        return conn.open;\n      });\n    });\n  }\n\n  function connectToPeers() {\n    onOpen(peer);\n    peers\n        .filter(function (id) {\n          return !peer.connections || peer.connections[id] === undefined;\n        })\n        .forEach(function (id) {\n          console.log('connecting with ' + id + '...');\n          const conn = peer.connect(id);\n          setupConnection(conn);\n        });\n  }\n\n  function setupConnection(conn) {\n    conn\n        .on('open', function () {\n          console.log('connected with ' + conn.peer);\n        })\n        .on('data', function(data) {\n          //console.log('receive', conn.peer, data);\n          ts.receive(conn.peer, data);\n        })\n        .on('close', function () {\n          console.log('disconnected from ' + conn.peer);\n        })\n        .on('error', function (err) {\n          console.log('Error', err);\n        });\n  }\n\n  // check whether there are connections missing every 10 sec\n  setInterval(connectToPeers, 10000);\n\n  return {\n    peer: peer,\n    ts: ts\n  };\n}\n","import React from 'react';\nimport * as qs from 'qs';\nimport { debounce, omit } from 'lodash';\n\nimport LabeledKnob from './LabeledKnob';\nimport WaveformSelector from './WaveformSelector';\nimport Keyboard from './Keyboard';\nimport Sequencer from './Sequencer';\nimport Oscilloscope from './Oscilloscope';\nimport SpectrumAnalyser from './SpectrumAnalyser';\nimport VisibilitySettings from './VisibilitySettings'\n\nimport {\n  keyToDegree,\n  getDegreeForKey,\n  degreeToFrequency,\n} from '../utils/KeyboardUtils';\n\nimport createSynthesizer, { defaultConfig } from '../Synthesizer';\n\nimport connect from '../webRtcConnection';\n\nfunction convertToBooleanConfig(config) {\n  const res = Object.entries(config).reduce((acc, [key, value]) => {\n    return {\n      ...acc,\n      [key]: value === 'true',\n    };\n  }, {});\n  return res;\n}\n\nfunction convertToNumericConfig(config) {\n  const res = Object.entries(config).reduce((acc, [key, value]) => {\n    return {\n      ...acc,\n      [key]: isNaN(value) ? value : Number(value),\n    };\n  }, {});\n  return res;\n}\n\nconst defaultSectionsShown = {\n  keyboard: true,\n  sequencer: false,\n  filter: true,\n  modulation: true,\n};\n\nfunction getStateFromQueryString() {\n  const queryString = window.location.search.slice(1);\n  const queryParams = qs.parse(queryString, { arrayLimit: 0 });\n\n  const synthConfig = {\n    ...defaultConfig,\n    ...convertToNumericConfig(omit(queryParams, 'na', 'nd', 'ss')),\n  };\n\n  const pattern = {\n    activeSettings: convertToBooleanConfig(queryParams.na || {}),\n    degreeSettings: convertToNumericConfig(queryParams.nd || {}),\n  };\n\n  const sectionsShown = {\n    ...defaultSectionsShown,\n    ...convertToBooleanConfig(queryParams.ss || {}),\n  };\n\n  return {\n    synthConfig,\n    pattern,\n    sectionsShown,\n  };\n}\n\n\nclass SynthContainer extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const queryState = getStateFromQueryString();\n    const { synthConfig } = queryState;\n\n    const audioCtx = new AudioContext({ latencyHint: 0 });\n\n    this.synthesizer = createSynthesizer(synthConfig, audioCtx);\n\n    this.keysHeld = [];\n    this.keyIsHeld = false;\n\n    this.tempo = 100;\n\n    this.audioCtx = audioCtx;\n\n    this.state = {\n      ...queryState,\n      vco1Freq: 440,\n      vco2Freq: 440,\n      isLeader: false,\n      peerId: undefined,\n      connectedPeerId: undefined,\n    };\n\n    this.onConfigChange = this.onConfigChange.bind(this);\n    this.onNoteDegreeChange = this.onNoteDegreeChange.bind(this);\n    this.onNoteActiveChange = this.onNoteActiveChange.bind(this);\n    this.onVisibilityChange = this.onVisibilityChange.bind(this);\n    this.connectToPeer = this.connectToPeer.bind(this);\n    this.becomeLeader = this.becomeLeader.bind(this);\n    this.getCurrentTime = this.getCurrentTime.bind(this);\n    this.pushHistoryUpdateDebounced = debounce(\n      this.pushHistoryUpdate.bind(this),\n      1000,\n      { trailing: true },\n    );\n  }\n\n  componentDidMount() {\n    document.body.addEventListener('keydown', (e) => {\n      if (!this.keysHeld.includes(e.key) && e.key in keyToDegree) {\n        this.keysHeld.push(e.key);\n      }\n      this.onKeysChanged();\n    });\n\n    document.body.addEventListener('keyup', (e) => {\n      this.keysHeld.splice(this.keysHeld.indexOf(e.key), 1);\n      this.onKeysChanged();\n    });\n\n    window.addEventListener('popstate', (e) => {\n      const queryState = getStateFromQueryString();\n\n      this.synthesizer.updateConfig(queryState.synthConfig);\n      this.setState(queryState);\n    });\n\n    const NOTE_SCHEDULING_INTERVAL_MS = 100;\n    const NOTE_SCHEDULING_RANGE_MS = 150;\n\n    this.lastScheduledTime = -1;;\n\n    const scheduleNotes = () => {\n      const currentTime = this.getCurrentTime();\n      const startTime = currentTime;\n      const endTime = startTime + NOTE_SCHEDULING_RANGE_MS / 1000;\n\n      const secondsPerBeat = (60 / (this.tempo * 4));\n\n      let nextAttackIndex = Math.ceil(currentTime / secondsPerBeat);\n\n      const attacks = [];\n\n      const {\n        pattern: {\n          activeSettings,\n          degreeSettings,\n        },\n      } = this.state;\n\n      while (nextAttackIndex * secondsPerBeat < endTime) {\n        if (activeSettings[nextAttackIndex % 16]) {\n          attacks.push([nextAttackIndex, degreeSettings[nextAttackIndex % 16] || 0]);\n        }\n        nextAttackIndex += 1;\n      }\n\n      attacks.forEach(([attackIndex, degree]) => {\n        this.scheduleAttack({ startTime, endTime, nextAttackTime: attackIndex * secondsPerBeat, timeToRelease: secondsPerBeat * 0.9, degree });\n      });\n\n      this.lastScheduledTime = endTime;\n\n      setTimeout(scheduleNotes, NOTE_SCHEDULING_INTERVAL_MS);\n    };\n\n    scheduleNotes();\n\n    // Fix taken from https://github.com/peers/peerjs/issues/278#issuecomment-107276110\n    const pingPeer = () => {\n      if (this.peer) {\n        this.peer.socket.send({type: 'ping'});\n      }\n\n      setTimeout(pingPeer, 20000);\n    };\n\n    setTimeout(pingPeer, 20000);\n  }\n\n  connectToPeer() {\n    const { connectedPeerId } = this.state;\n    const { peer, ts } = connect(\n      connectedPeerId ? [connectedPeerId] : [],\n      this.audioCtx,\n      (peer) => {\n        this.setState({ peerId: peer.id });\n      },\n    );\n\n    this.peer = peer;\n    this.timesync = ts;\n  }\n\n  becomeLeader() {\n    this.setState(\n      {\n        connectedPeerId: '',\n        isLeader: true,\n      },\n      () => this.connectToPeer(),\n    );\n  };\n\n  getCurrentTime() {\n    if (!this.timesync) {\n      return this.audioCtx.currentTime;\n    }\n\n    return this.timesync.now();\n  }\n\n  scheduleAttack({\n    startTime,\n    endTime,\n    nextAttackTime,\n    timeToRelease,\n    degree,\n  }) {\n    if (\n      nextAttackTime > startTime &&\n      nextAttackTime < endTime &&\n      nextAttackTime > this.lastScheduledTime\n    ) {\n      const offset = this.timesync ? this.timesync.offset : 0;\n      if (this.keysHeld.length < 1) {\n        const frequency = degreeToFrequency(degree);\n\n        this.synthesizer.setVcoFrequencyAtTime(frequency, nextAttackTime - offset);\n      }\n\n      this.synthesizer.scheduleAttackAtTime(nextAttackTime - offset);\n\n      // Also do release, since we already know when it's going to be and there\n      // won't be another attack between this one and the release\n      // TODO: this will need to be changed at some point as this ^^^ shouldn't be guaranteed\n      this.synthesizer.scheduleReleaseAtTime(nextAttackTime + timeToRelease - offset);\n    }\n  }\n\n  pushHistoryUpdate() {\n    const {\n      synthConfig,\n      pattern: {\n        activeSettings,\n        degreeSettings,\n      },\n      sectionsShown,\n    }= this.state;\n\n    const configDiff = Object.entries(synthConfig).reduce((acc, [key, value]) => {\n      if (defaultConfig[key] !== value) {\n        return {\n          ...acc,\n          [key]: value,\n        };\n      }\n      return acc;\n    }, {});\n\n    const na = Object.entries(activeSettings).reduce((acc, [key, value]) => {\n      if (value) {\n        return {\n          ...acc,\n          [key]: value,\n        };\n      }\n      return acc;\n    }, {});\n\n    const nd = Object.entries(degreeSettings).reduce((acc, [key, value]) => {\n      if (value !== 0) {\n        return {\n          ...acc,\n          [key]: value,\n        };\n      }\n      return acc;\n    }, {});\n\n    const ss = Object.entries(sectionsShown).reduce((acc, [key, value]) => {\n      if (defaultSectionsShown[key] !== value) {\n        return {\n          ...acc,\n          [key]: value,\n        };\n      }\n      return acc;\n    }, {});\n\n    const diff = {\n      ...configDiff,\n      na,\n      nd,\n      ss,\n    };\n    window.history.pushState({}, '', `?${qs.stringify(diff)}`);\n  }\n\n  onKeysChanged() {\n    if (this.keysHeld.length === 0) {\n      if (this.keyIsHeld) {\n        this.onReleaseTrigger();\n        this.keyIsHeld = false;\n      }\n    } else {\n      if (!this.keyIsHeld) {\n        this.onAttackTrigger();\n        this.keyIsHeld = true;\n      }\n      this.setVcoFreq();\n    }\n  }\n\n  onAttackTrigger() {\n    const currentTime = this.audioCtx.currentTime;\n    this.synthesizer.scheduleAttackAtTime(currentTime);\n  }\n\n  onReleaseTrigger() {\n    const currentTime = this.audioCtx.currentTime;\n    this.synthesizer.scheduleReleaseAtTime(currentTime);\n  }\n\n  onNoteDegreeChange(note, degree) {\n    this.setState(({ pattern }) => ({\n      pattern: {\n        ...pattern,\n        degreeSettings: {\n          ...pattern.degreeSettings,\n          [note]: degree,\n        },\n      },\n    }),\n    () => {\n      this.pushHistoryUpdateDebounced();\n    });\n  }\n\n  onNoteActiveChange(note, active) {\n    this.setState(({ pattern }) => ({\n      pattern: {\n        ...pattern,\n        activeSettings: {\n          ...pattern.activeSettings,\n          [note]: active,\n        },\n      },\n    }),\n    () => {\n      this.pushHistoryUpdateDebounced();\n    });\n  }\n\n  setVcoFreq() {\n    if (this.keysHeld.length < 1) {\n      return;\n    }\n\n    const degree = getDegreeForKey(this.keysHeld[this.keysHeld.length - 1]);\n\n    const frequency = degreeToFrequency(degree);\n\n    this.synthesizer.setVcoFrequencyAtTime(frequency, 0);\n\n    this.setState({ vco1Freq: frequency, vco2Freq: frequency });\n  }\n\n  onConfigChange(key, value) {\n    this.synthesizer.updateConfig({ [key]: value });\n    this.setState(({ synthConfig }) => ({\n      synthConfig: {\n        ...synthConfig,\n        [key]: value,\n      },\n    }),\n    () => {\n      this.pushHistoryUpdateDebounced();\n    });\n  }\n\n  onVisibilityChange(sectionsShown) {\n    this.setState({ sectionsShown }, () => this.pushHistoryUpdateDebounced());\n  }\n\n  render() {\n    const {\n      synthConfig: config,\n      vco1Freq,\n      peerId,\n      connectedPeerId,\n      pattern,\n      isLeader,\n      sectionsShown,\n    } = this.state;\n    return (\n      <div>\n        <VisibilitySettings\n          sectionsShown={sectionsShown}\n          onChange={this.onVisibilityChange}\n        />\n        <div>\n          {sectionsShown.keyboard &&\n            <Keyboard\n              pattern={pattern}\n              getCurrentTime={this.getCurrentTime}\n              tempo={this.tempo}\n            />\n          }\n        </div>\n        <div>\n          {sectionsShown.sequencer &&\n            <Sequencer\n              pattern={pattern}\n              onNoteActiveChange={this.onNoteActiveChange}\n              onNoteDegreeChange={this.onNoteDegreeChange}\n              getCurrentTime={this.getCurrentTime}\n              tempo={this.tempo}\n            />\n          }\n        </div>\n        <div className=\"inline-container\">\n          <div className=\"section-container\">\n            <h3>Oscillator 1</h3>\n            <div>\n              <WaveformSelector\n                value={config.vco1Waveform}\n                onChange={(value) => {\n                  this.onConfigChange('vco1Waveform', value);\n                }}\n              />\n            </div>\n            <div className=\"inline-container\">\n              <LabeledKnob\n                label=\"Volume\"\n                valueKey=\"vco1Volume\"\n                onChange={this.onConfigChange}\n                config={config}\n              />\n            </div>\n            <div className=\"inline-container\">\n              <LabeledKnob\n                label=\"Detune\"\n                min={-1200}\n                max={1200}\n                valueKey=\"vco1Detune\"\n                onChange={this.onConfigChange}\n                config={config}\n              />\n            </div>\n            <div className=\"inline-container\">\n              <LabeledKnob\n                label=\"Octave\"\n                valueKey=\"vco1Octave\"\n                min={-4}\n                max={2}\n                step={1}\n                onChange={this.onConfigChange}\n                config={config}\n              />\n            </div>\n          </div>\n          <div className=\"section-container\">\n            <h3>Oscillator 2</h3>\n            <div>\n              <WaveformSelector\n                value={config.vco2Waveform}\n                onChange={(value) => {\n                  console.log(value);\n                  this.onConfigChange('vco2Waveform', value);\n                }}\n              />\n            </div>\n            <div className=\"inline-container\">\n              <LabeledKnob\n                label=\"Volume\"\n                valueKey=\"vco2Volume\"\n                onChange={this.onConfigChange}\n                config={config}\n              />\n            </div>\n            <div className=\"inline-container\">\n              <LabeledKnob\n                label=\"Detune\"\n                min={-1200}\n                max={1200}\n                valueKey=\"vco2Detune\"\n                onChange={this.onConfigChange}\n                config={config}\n              />\n            </div>\n            <div className=\"inline-container\">\n              <LabeledKnob\n                label=\"Octave\"\n                valueKey=\"vco2Octave\"\n                min={-4}\n                max={2}\n                step={1}\n                onChange={this.onConfigChange}\n                config={config}\n              />\n            </div>\n          </div>\n          <div className=\"section-container\">\n            <h3>Noise</h3>\n            <div className=\"inline-container\">\n              <LabeledKnob\n                label=\"Volume\"\n                valueKey=\"noiseVolume\"\n                onChange={this.onConfigChange}\n                config={config}\n              />\n            </div>\n          </div>\n          {sectionsShown.modulation &&\n            <div className=\"section-container\">\n              <h3>Frequency Modulation</h3>\n              <div className=\"inline-container\">\n                <LabeledKnob\n                  label=\"Envelope\"\n                  max={1200}\n                  valueKey=\"vcoFreqEnvMod\"\n                  onChange={this.onConfigChange}\n                  config={config}\n                />\n              </div>\n              <div className=\"inline-container\">\n                <LabeledKnob\n                  label=\"LFO\"\n                  max={600}\n                  valueKey=\"vcoFreqLfoMod\"\n                  onChange={this.onConfigChange}\n                  config={config}\n                />\n              </div>\n            </div>\n          }\n        </div>\n        {sectionsShown.filter &&\n          <div className=\"inline-container\">\n            <div className=\"section-container\">\n              <h3>High Pass Filter</h3>\n              <div>\n                <div className=\"inline-container\">\n                  <LabeledKnob\n                    label=\"Frequency\"\n                    min={0}\n                    max={10000}\n                    valueKey=\"fltHighPassFreq\"\n                    onChange={this.onConfigChange}\n                    config={config}\n                  />\n                </div>\n                <div className=\"inline-container\">\n                  <LabeledKnob\n                    label=\"Resonance\"\n                    min={0}\n                    max={40}\n                    valueKey=\"fltHighPassRes\"\n                    onChange={this.onConfigChange}\n                    config={config}\n                  />\n                </div>\n              </div>\n              {sectionsShown.modulation &&\n                <div>\n                  <div className=\"inline-container\">\n                    <LabeledKnob\n                      label=\"Envelope Mod\"\n                      min={0}\n                      max={10000}\n                      valueKey=\"fltHpEnvMod\"\n                      onChange={this.onConfigChange}\n                      config={config}\n                    />\n                  </div>\n                  <div className=\"inline-container\">\n                    <LabeledKnob\n                      label=\"LFO Mod\"\n                      min={0}\n                      max={10000}\n                      valueKey=\"fltHpLfoMod\"\n                      onChange={this.onConfigChange}\n                      config={config}\n                    />\n                  </div>\n                </div>\n              }\n            </div>\n            <div className=\"section-container\">\n              <h3>Low Pass Filter</h3>\n              <div>\n                <div className=\"inline-container\">\n                  <LabeledKnob\n                    label=\"Frequency\"\n                    min={0}\n                    max={10000}\n                    valueKey=\"fltLowPassFreq\"\n                    onChange={this.onConfigChange}\n                    config={config}\n                  />\n                </div>\n                <div className=\"inline-container\">\n                  <LabeledKnob\n                    label=\"Resonance\"\n                    min={0}\n                    max={40}\n                    valueKey=\"fltLowPassRes\"\n                    onChange={this.onConfigChange}\n                    config={config}\n                  />\n                </div>\n              </div>\n              {sectionsShown.modulation &&\n                <div>\n                  <div className=\"inline-container\">\n                    <LabeledKnob\n                      label=\"Envelope Mod\"\n                      min={0}\n                      max={10000}\n                      valueKey=\"fltLpEnvMod\"\n                      onChange={this.onConfigChange}\n                      config={config}\n                    />\n                  </div>\n                  <div className=\"inline-container\">\n                    <LabeledKnob\n                      label=\"LFO Mod\"\n                      min={0}\n                      max={10000}\n                      valueKey=\"fltLpLfoMod\"\n                      onChange={this.onConfigChange}\n                      config={config}\n                    />\n                  </div>\n                </div>\n              }\n            </div>\n          </div>\n        }\n        <div className=\"inline-container\">\n          {sectionsShown.modulation &&\n            <div className=\"section-container\">\n              <h3>LFO</h3>\n              <div className=\"inline-container\">\n                <LabeledKnob\n                  label=\"Frequency\"\n                  min={0}\n                  max={20}\n                  valueKey=\"lfoFreq\"\n                  onChange={this.onConfigChange}\n                  config={config}\n                />\n              </div>\n            </div>\n          }\n          {sectionsShown.modulation &&\n            <div className=\"section-container\">\n              <h3>Envelope</h3>\n              <div className=\"inline-container\">\n                <LabeledKnob\n                  label=\"Attack\"\n                  min={0.004}\n                  max={5}\n                  valueKey=\"envAttack\"\n                  onChange={this.onConfigChange}\n                  config={config}\n                />\n              </div>\n              <div className=\"inline-container\">\n                <LabeledKnob\n                  label=\"Decay\"\n                  min={0.004}\n                  max={5}\n                  valueKey=\"envDecay\"\n                  onChange={this.onConfigChange}\n                  config={config}\n                />\n              </div>\n              <div className=\"inline-container\">\n                <LabeledKnob\n                  label=\"Sustain\"\n                  valueKey=\"envSustain\"\n                  onChange={this.onConfigChange}\n                  config={config}\n                />\n              </div>\n              <div className=\"inline-container\">\n                <LabeledKnob\n                  label=\"Release\"\n                  min={0.004}\n                  max={5}\n                  valueKey=\"envRelease\"\n                  onChange={this.onConfigChange}\n                  config={config}\n                />\n              </div>\n            </div>\n          }\n          <div className=\"section-container\">\n            <h3>Oscilloscope</h3>\n            <Oscilloscope\n              vco1Octave={config.vco1Octave}\n              vco2Octave={config.vco2Octave}\n              freq={vco1Freq}\n              sampleRate={this.audioCtx.sampleRate}\n              analyser={this.synthesizer.analyser}\n            />\n            <h3>Spectrum Analyser</h3>\n            <SpectrumAnalyser\n              analyser={this.synthesizer.analyser}\n            />\n          </div>\n        </div>\n        <div className=\"inline-container\">\n          <div className=\"section-container\">\n            <h3>Beat Connection</h3>\n            {!isLeader &&\n              <label>\n                {'Leader ID:\\u00A0'}\n                <input type=\"text\" value={connectedPeerId} onChange={(e) => this.setState({ connectedPeerId: e.target.value })} />\n              </label>\n            }\n            {!isLeader &&\n              <button onClick={this.connectToPeer}>Connect to leader</button>\n            }\n            {!isLeader && !peerId &&\n              <div style={{ marginTop: 10 }}>\n                <button onClick={this.becomeLeader}>Become leader</button>\n              </div>\n            }\n            {peerId &&\n              <div>ID: {peerId}</div>\n            }\n            <div id=\"systemTime\" />\n            <div id=\"syncTime\" />\n            <div id=\"offset\" />\n            <div id=\"syncing\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default SynthContainer;\n","import React, { Component } from 'react';\nimport './App.css';\nimport SynthContainer from './components/SynthContainer';\n\n\nclass App extends Component {\n  render() {\n    return (\n      <div style={{ padding: 30 }}>\n        <SynthContainer />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (!isLocalhost) {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      } else {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport registerServiceWorker from './registerServiceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\nregisterServiceWorker();\n"],"sourceRoot":""}